- name: Run through story with preconditions
  tags:
    - preconditions
    - simple
    - documentation
    - happy
  preconditions:
    files:
      example.story: |
        Do thing:
          description: General description.
          about:
            jiras: JIRA-123, JIRA-124
            features: files, creating
          scenario:
            - Do thing

        Do other thing:
          about:
            jiras: JIRA-789
            features: other
          scenario:
            - Do other thing
  scenario:
    - Run command: |
        from hitchstory import StoryCollection, BaseEngine
        from strictyaml import Map, Str, CommaSeparated

        class Engine(BaseEngine):
            about_schema = Map({
                "description": Str(),
                "jiras": CommaSeparated(Str()),
                "features": CommaSeparated(Str()),
            })

            def do_thing(self):
                output("thing")

            def do_other_thing(self):
                output("other thing")

    - Run command: StoryCollection(".", Engine()).ordered_by_name().play()
    - Output is: |
        other thing
        thing

    - Run command: |
        StoryCollection(".", Engine()).filter(lambda story: "JIRA-124" in story.about['jiras']).ordered_by_name().play()
    - Output is: |
        thing
