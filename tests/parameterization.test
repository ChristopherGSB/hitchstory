- name: Story with parameters
  description: |
    Parameters are used to describe stories which remain
    identical except for a changed precondition or step.

    You can use them to perform property based testing
    or to inherit one story from another where there
    is a minor variation.

    Parameters can only be used in preconditions or in
    steps. If you wish to use a parameter in a step or
    a precondition, that precondition or step value
    *must* accept strings.
  tags:
    - preconditions
    - parameters
    - simple
    - documentation
    - happy
  preconditions:
    files:
      example.story: |
        Create files:
          preconditions:
            content: (( myparameter ))
            hierarchical content:
              x: 1
              y:
                - (( parameter2 ))
          scenario:
            - Do thing with precondition
            - Do other thing: (( myparameter ))
            - Do yet another thing
            - Do a fourth thing:
                animals:
                  pond animal: (( parameter3 ))
          params:
            myparameter: dog
            parameter2: 42
            parameter3: frog
  scenario:
    - Run command: |
        from hitchstory import StoryCollection, BaseEngine, StorySchema, validate
        from strictyaml import Map, Seq, Int, Str
        from pathquery import pathq


        class Engine(BaseEngine):
            schema = StorySchema(
                preconditions={
                    "content": Str(),
                    "hierarchical content": Map({
                        "x": Int(),
                        "y": Seq(Str()),
                    }),
                },
                params={
                    "myparameter": Str(),
                    "parameter2": Int(),
                    "parameter3": Str(),
                },
            )

            def do_other_thing(self, parameter):
                assert type(parameter) is str
                append(parameter)

            def do_thing_with_precondition(self):
                assert type(self.preconditions['content']) is str
                append(self.preconditions['content'])

            def do_yet_another_thing(self):
                assert type(self.preconditions['hierarchical content']['y'][0]) is str
                append(self.preconditions['hierarchical content']['y'][0])

            @validate(animals=Map({"pond animal": Str()}))
            def do_a_fourth_thing(self, animals=None):
                assert type(animals['pond animal']) is str
                append(animals['pond animal'])

        print(StoryCollection(pathq(".").ext("story"), Engine()).one().play().report())
    - Output is: |
        dog
        dog
        42
        frog
